<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frozo Store - Categories & Products</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Load Stripe Buy Button script once globally -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>

  <style>
    @keyframes move {
      100% {
          transform: translate3d(0, 0, 1px) rotate(360deg);
      }
    }

    .background {
        position: fixed;
        width: 100vw;
        height: 100vh;
        top: 0;
        left: 0;
        background: #000b19;
        overflow: hidden;
        z-index: -1; /* put background behind content */
    }

    .background span {
        width: 20vmin;
        height: 20vmin;
        border-radius: 20vmin;
        backface-visibility: hidden;
        position: absolute;
        animation: move;
        animation-duration: 45s;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }

    /* Your nth-child styles: */
    .background span:nth-child(1) {
        color: #5d00ff;
        top: 41%;
        left: 64%;
        animation-duration: 50s;
        animation-delay: -29s;
        transform-origin: -14vw -11vh;
        box-shadow: 40vmin 0 5.33vmin currentColor;
    }
    .background span:nth-child(2) {
        color: #5d00ff;
        top: 65%;
        left: 80%;
        animation-duration: 55s;
        animation-delay: -12s;
        transform-origin: 14vw 5vh;
        box-shadow: -40vmin 0 5.46vmin currentColor;
    }
    .background span:nth-child(3) {
        color: #5d00ff;
        top: 31%;
        left: 4%;
        animation-duration: 16s;
        animation-delay: -41s;
        transform-origin: 12vw 19vh;
        box-shadow: 40vmin 0 5.74vmin currentColor;
    }
    .background span:nth-child(4) {
        color: #00aaff;
        top: 38%;
        left: 20%;
        animation-duration: 53s;
        animation-delay: -13s;
        transform-origin: 7vw -1vh;
        box-shadow: -40vmin 0 5.61vmin currentColor;
    }
    /* ... repeat for all your spans from nth-child(5) to nth-child(23) ... */

    /* Important: fix your nth-child indexing from 0 to 1 based (CSS nth-child starts from 1) */
    /* I corrected that here, all nth-child(0) should be nth-child(1), etc. */

  </style>
</head>
<body>
  
  <div class="background">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>

  <header>
    <h1>Frozone Store</h1>
    <h3>your number 1 for cheap products</h3>
  </header>
  
  <section class="categories" id="category-list">
    <!-- Categories will load here -->
  </section>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="modal-close" class="close">&times;</span>
      <h2 id="modal-title"></h2>

      <!-- Products list -->
      <div id="modal-products" class="modal-products"></div>

      <!-- Single product details, hidden by default -->
      <div id="modal-product-detail" class="modal-product-detail" style="display:none;">
        <button id="back-to-products" class="back-button">‚Üê Back to products</button>
        <h3 id="detail-name"></h3>
        <img id="detail-image" src="" alt="" />
        <p><strong>Price:</strong> $<span id="detail-price"></span></p>
        <p><strong>Stock:</strong> <span id="detail-stock"></span></p>
        <p id="detail-description"></p>
        <!-- Stripe Buy Button container -->
        <div id="buy-button-container" style="margin-top: 1rem;"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAveoEg2mxueUIezZfPlvnRj28JKZD13KE",
      authDomain: "frozo-3ba69.firebaseapp.com",
      projectId: "frozo-3ba69",
      storageBucket: "frozo-3ba69.firebasestorage.app",
      messagingSenderId: "183765467189",
      appId: "1:183765467189:web:b7a47c91c2dbaca7c1717c",
      measurementId: "G-YMQ7G7MZ95"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const categoryList = document.getElementById('category-list');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalProducts = document.getElementById('modal-products');
    const modalProductDetail = document.getElementById('modal-product-detail');
    const modalClose = document.getElementById('modal-close');
    const backToProductsBtn = document.getElementById('back-to-products');

    // Detail elements
    const detailName = document.getElementById('detail-name');
    const detailImage = document.getElementById('detail-image');
    const detailPrice = document.getElementById('detail-price');
    const detailStock = document.getElementById('detail-stock');
    const detailDescription = document.getElementById('detail-description');
    const buyButtonContainer = document.getElementById('buy-button-container');

    // Load categories from Firestore
    async function loadCategories() {
      const categoriesSnapshot = await getDocs(collection(db, "categories"));
      if (categoriesSnapshot.empty) {
        categoryList.innerHTML = '<p>No categories found.</p>';
        return;
      }
      categoryList.innerHTML = '';
      categoriesSnapshot.forEach(doc => {
        const categoryId = doc.id;
        const div = document.createElement('div');
        div.className = 'category-card';
        div.textContent = categoryId.charAt(0).toUpperCase() + categoryId.slice(1);
        div.onclick = () => openCategoryModal(categoryId);
        categoryList.appendChild(div);
      });
    }

    // Show product list for a category
    async function openCategoryModal(categoryId) {
      modalTitle.textContent = categoryId.charAt(0).toUpperCase() + categoryId.slice(1);
      modalProducts.innerHTML = 'Loading...';
      modalProducts.style.display = 'grid';
      modalProductDetail.style.display = 'none';

      const productsRef = collection(db, "categories", categoryId, "products");
      const productsSnapshot = await getDocs(productsRef);

      if (productsSnapshot.empty) {
        modalProducts.innerHTML = '<p>No items found in this category.</p>';
      } else {
        modalProducts.innerHTML = '';
        productsSnapshot.forEach(doc => {
          const data = doc.data();
          const productCard = document.createElement('div');
          productCard.className = 'product-card';
          productCard.innerHTML = `
            <img src="${data.image || 'https://via.placeholder.com/150'}" alt="${data.name}" />
            <h4>${data.name}</h4>
            <p>$${data.price?.toFixed(2) || '0.00'}</p>
          `;
          productCard.onclick = () => showProductDetail(data);
          modalProducts.appendChild(productCard);
        });
      }

      modal.style.display = "block";
    }

    // Show single product detail in modal
    function showProductDetail(product) {
      modalTitle.textContent = product.name;
      detailName.textContent = product.name;
      detailImage.src = product.image || 'https://via.placeholder.com/300x200';
      detailImage.alt = product.name;
      detailPrice.textContent = product.price?.toFixed(2) || '0.00';
      detailStock.textContent = product.stock ?? 'N/A';
      detailDescription.textContent = product.description || '';

      // Inject Stripe buy button HTML (just the <stripe-buy-button> tag)
      buyButtonContainer.innerHTML = product.button || '';

      modalProducts.style.display = 'none';
      modalProductDetail.style.display = 'block';
    }

    // Close modal
    modalClose.onclick = () => {
      modal.style.display = "none";
    };

    // Back to products list
    backToProductsBtn.onclick = () => {
      modalProductDetail.style.display = 'none';
      modalProducts.style.display = 'grid';
      // Reset modal title if needed (category name)
    };

    // Close modal if click outside content
    window.onclick = (event) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };

    loadCategories();
  </script>
</body>
</html>
